generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}


datasource db {
  provider = "postgresql"
}


model Estabelecimento {
  id        String   @id @default(uuid())
  nome      String
  plano     Plano    @default(FREE)
  ativo     Boolean  @default(true)
  limiteProdutos Int  @default(50)
  limiteUsuarios Int  @default(1)
  createdAt DateTime @default(now())

  usuarios       Usuario[]
  produtos       Produto[]
  fornecedores   Fornecedor[]
  movimentacoes  Movimentacao[]
}

model Usuario {
  id        String   @id @default(uuid())
  nome      String
  email     String   @unique
  senhaHash String
  role      Role     @default(FUNCIONARIO)

  estabelecimentoId String
  estabelecimento   Estabelecimento @relation(fields: [estabelecimentoId], references: [id])

  createdAt DateTime @default(now())
}

model Produto {
  id        String   @id @default(uuid())
  nome      String
  categoria Categoria
  volume    String?

  estoqueAtual   Int    @default(0)
  estoqueMinimo  Int    @default(5)

  precoCompra Float?
  precoVenda  Float?

  status Status @default(OK)

  fornecedorId String?
  fornecedor   Fornecedor? @relation(fields: [fornecedorId], references: [id])

  estabelecimentoId String
  estabelecimento   Estabelecimento @relation(fields: [estabelecimentoId], references: [id])

  movimentacoes Movimentacao[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([estabelecimentoId])
  @@index([estabelecimentoId, createdAt])
}

model Movimentacao {
  id        String   @id @default(uuid())
  tipo      TipoMovimentacao
  quantidade Int
  data      DateTime @default(now())
  observacao String?
  valorUnitario      Float?
  valorTotal         Float?

  produtoId String
  produto   Produto @relation(fields: [produtoId], references: [id])

  estabelecimentoId String
  estabelecimento   Estabelecimento @relation(fields: [estabelecimentoId], references: [id])

  createdAt DateTime @default(now())

  @@index([estabelecimentoId])
  @@index([produtoId])
  @@index([estabelecimentoId, produtoId])
  @@index([estabelecimentoId, data])
}

model Fornecedor {
  id        String   @id @default(uuid())
  nome      String
  telefone  String?
  prazoEntregaDias Int @default(2)

  estabelecimentoId String
  estabelecimento   Estabelecimento @relation(fields: [estabelecimentoId], references: [id])

  produtos Produto[]

  createdAt DateTime @default(now())

  @@index([estabelecimentoId])
}

enum Role {
  ADMIN
  FUNCIONARIO
}

enum Plano {
  FREE
  PRO
}

enum Categoria {
  Cerveja
  Refrigerante
  Destilado
  Vinho
  Agua
  Suco
  Energetico
  Outros
}

enum TipoMovimentacao {
  Entrada
  Saida
}

enum Status {
  OK
  Atencao
  Repor
}
